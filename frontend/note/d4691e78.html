<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    
    <title>
       webpack原理以及主流程源码阅读 |  前端迷
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="前端迷,前端开发,前端知识大全,前端优化,前端导航,小程序,ru23.com,JavaScript,ajax,angular,css,webpack,react,gulp,htmlhtml5,mocha,nginx,node,css3,vue,vue-cli,scss">
     <meta name="description" content="简单概述 Webpack 整体运行流程 读取参数 实例化 Compiler entryOption 阶段，读取入口文件 Loader 编译对应文件，解析成 AST 找到对应依赖，递归编译处理，生成 chunk 输出到 dist  webpack 打包主流程源码阅读通过打断点的方式阅读源码,来看一下命令行输入 webpack 的时候都发生了什么？P.S. 以下的源码流程分析都基于 webpack4">
<meta name="keywords" content="webpack">
<meta property="og:type" content="article">
<meta property="og:title" content="webpack原理以及主流程源码阅读">
<meta property="og:url" content="https://ru23.com/note/d4691e78.html">
<meta property="og:site_name" content="前端迷">
<meta property="og:description" content="简单概述 Webpack 整体运行流程 读取参数 实例化 Compiler entryOption 阶段，读取入口文件 Loader 编译对应文件，解析成 AST 找到对应依赖，递归编译处理，生成 chunk 输出到 dist  webpack 打包主流程源码阅读通过打断点的方式阅读源码,来看一下命令行输入 webpack 的时候都发生了什么？P.S. 以下的源码流程分析都基于 webpack4">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://cdn.6fed.com/github/webpack/webpack/webpack-process.png">
<meta property="og:image" content="https://cdn.6fed.com/github/webpack/webpack/my-webpack-done.jpg">
<meta property="og:updated_time" content="2020-08-30T13:54:35.492Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="webpack原理以及主流程源码阅读">
<meta name="twitter:description" content="简单概述 Webpack 整体运行流程 读取参数 实例化 Compiler entryOption 阶段，读取入口文件 Loader 编译对应文件，解析成 AST 找到对应依赖，递归编译处理，生成 chunk 输出到 dist  webpack 打包主流程源码阅读通过打断点的方式阅读源码,来看一下命令行输入 webpack 的时候都发生了什么？P.S. 以下的源码流程分析都基于 webpack4">
<meta name="twitter:image" content="https://cdn.6fed.com/github/webpack/webpack/webpack-process.png">  
    <link rel="icon" href="//cdn.ru23.com/img/favicon.ico">
    
    <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/style.css"> <script src="//cdn.ru23.com/js/pace.min.js"></script> 
  
  </head><body><div style="display: none;">
    <script src="//s22.cnzz.com/z_stat.php?id=1275440747&web_id=1275440747" language="JavaScript"></script>
  </div>


  




  <div id="container">
    <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/" class="left">
                    <span class="site-title">前端迷</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a target="_blank" href="https://58fe.com">
                        <i class="fa fa-heart"></i>
                        <span>前端社区</span>
                    </a>
                    
                    <a href="/">
                        <i class="fa fa-home"></i>
                        <span>主页</span>
                    </a>
                    
                    <a href="/archives">
                        <i class="fa fa-archive"></i>
                        <span>归档</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/">
                    <img src="//cdn.ru23.com/img/images/chrome.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        前端迷
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        凡事预则立，不预则废
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                        <a title="公众号" target="_blank" href="https://mp.weixin.qq.com/s/K3yG4eyuQvZxXIU9jas8kA">
                          <img src="//cdn.ru23.com/icon/mp.png" alt="logo">
                          </a>
                    
                        <a title="掘金" target="_blank" href="https://juejin.im/user/57fb24cf816dfa0056c1f8af">
                          <img src="//cdn.ru23.com/icon/juejin.png" alt="logo">
                          </a>
                    
                        <a title="Github" target="_blank" href="//github.com/ru23">
                          <img src="//cdn.ru23.com/icon/github.png" alt="logo">
                          </a>
                    
                        <a title="知乎" target="_blank" href="https://www.zhihu.com/people/58fe/activities">
                          <img src="//cdn.ru23.com/icon/zhihu.png" alt="logo">
                          </a>
                    
                </div>
            </nav>
        </div>
    </div>
</header>
    <div class="outer">
      <div class="outer-section">
        <section id="main" class="body-wrap"><article id="post-2020-08-webpack原理以及主流程源码阅读" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        <header class="article-header">
            
  
    <h1 class="post-title" itemprop="name">
      webpack原理以及主流程源码阅读
    </h1>
    <div class="post-title-bar">
      <ul>
          
              <li>
                  <i class="fa fa-book"></i>
                  
                      <a href="/categories/front-end/">front-end</a>
                  
              </li>
          
        <li>
          <i class="fa fa-calendar"></i>  2020-08-30
        </li>
        <li>
          <i class="fa fa-eye"></i>
          <span id="busuanzi_value_page_pv"></span>
        </li>
      </ul>
    </div>
  

            
        </header>
        
        <div class="article-entry post-content" itemprop="articleBody">
            
            
            <meta name="generator" content="Hexo 3.8.0"><h3 id="简单概述-Webpack-整体运行流程"><a href="#简单概述-Webpack-整体运行流程" class="headerlink" title="简单概述 Webpack 整体运行流程"></a>简单概述 Webpack 整体运行流程</h3><ol>
<li>读取参数</li>
<li>实例化 <code>Compiler</code></li>
<li><code>entryOption</code> 阶段，读取入口文件</li>
<li><code>Loader</code> 编译对应文件，解析成 <code>AST</code></li>
<li>找到对应依赖，递归编译处理，生成 <code>chunk</code></li>
<li>输出到 <code>dist</code></li>
</ol>
<h3 id="webpack-打包主流程源码阅读"><a href="#webpack-打包主流程源码阅读" class="headerlink" title="webpack 打包主流程源码阅读"></a>webpack 打包主流程源码阅读</h3><p>通过打断点的方式阅读源码,来看一下命令行输入 webpack 的时候都发生了什么？<br>P.S. 以下的源码流程分析都基于 <code>webpack4</code></p>
<p>先附上一张自己绘制的执行流程图<br><img src="https://cdn.6fed.com/github/webpack/webpack/webpack-process.png" alt="webpack4 执行流程图"></p>
<h4 id="初始化阶段"><a href="#初始化阶段" class="headerlink" title="初始化阶段"></a>初始化阶段</h4><ol>
<li>初始化参数（<code>webpack.config.js+shell options</code>）</li>
</ol>
<p><code>webpack</code> 的几种启动方式</p>
<ul>
<li>通过 <code>webpack-cli</code>执行 会走到 <code>./node_modules/.bin/webpack-cli</code>（执行）</li>
<li>通过 <code>shell</code> 执行<code>webpack</code> ，会走到 <code>./bin/webpack.js</code></li>
<li>通过 <code>require("webpack")</code>执行 会走到 <code>./node_modules/webpack/lib/webpack.js</code></li>
</ul>
<p>追加 <code>shell</code> 命令的参数，如<code>-p , -w，</code>通过 <code>yargs</code> 解析命令行参数<br><code>convert-yargs</code> 把命令行参数转换成 Webpack 的配置选项对象<br>同时实例化插件 <code>new Plugin()</code></p>
<ol start="2">
<li>实例化 <code>Compiler</code></li>
</ol>
<p><a href="https://github.com/webpack/webpack/blob/d6e8e479bce9ed34827e08850764bfb225947f85/lib/webpack.js#L39" target="_blank" rel="noopener">阅读完整源码点击这里：webpack.js</a></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack入口</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="function">(<span class="params">options, callback</span>) =></span> {</span><br><span class="line">  <span class="keyword">let</span> compiler</span><br><span class="line">  <span class="comment">// 实例Compiler</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(options)) {</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    compiler = createMultiCompiler(options)</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    compiler = createCompiler(options)</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// 若options.watch === true && callback 则开启watch线程</span></span><br><span class="line">  <span class="keyword">if</span> (watch) {</span><br><span class="line">    compiler.watch(watchOptions, callback)</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    compiler.run(<span class="function">(<span class="params">err, stats</span>) =></span> {</span><br><span class="line">      compiler.close(<span class="function">(<span class="params">err2</span>) =></span> {</span><br><span class="line">        callback(err || err2, stats)</span><br><span class="line">      })</span><br><span class="line">    })</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> compiler</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>webpack 的入口文件其实就实例了 <code>Compiler</code> 并调用了 <code>run</code> 方法开启了编译,</p>
<ol start="3">
<li>注册 <code>NodeEnvironmentPlugin</code> 插件，挂载 plugin 插件，使用 WebpackOptionsApply 初始化基础插件</li>
</ol>
<p>在此期间会 <code>apply</code> 所有 <code>webpack</code> 内置的插件,为 <code>webpack</code> 事件流挂上自定义钩子</p>
<p>源码仍然在<a href="https://github.com/webpack/webpack/blob/d6e8e479bce9ed34827e08850764bfb225947f85/lib/webpack.js#L39" target="_blank" rel="noopener">webpack.js</a>文件</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createCompiler = <span class="function">(<span class="params">rawOptions</span>) =></span> {</span><br><span class="line">  <span class="comment">// ...省略代码</span></span><br><span class="line">  <span class="keyword">const</span> compiler = <span class="keyword">new</span> Compiler(options.context)</span><br><span class="line">  compiler.options = options</span><br><span class="line">  <span class="comment">//应用Node的文件系统到compiler对象，方便后续的文件查找和读取</span></span><br><span class="line">  <span class="keyword">new</span> NodeEnvironmentPlugin({</span><br><span class="line">    infrastructureLogging: options.infrastructureLogging,</span><br><span class="line">  }).apply(compiler)</span><br><span class="line">  <span class="comment">// 加载插件</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(options.plugins)) {</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> plugin <span class="keyword">of</span> options.plugins) {</span><br><span class="line">      <span class="comment">//  依次调用插件的apply方法（默认每个插件对象实例都需要提供一个apply）若为函数则直接调用，将compiler实例作为参数传入，方便插件调用此次构建提供的Webpack API并监听后续的所有事件Hook。</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> plugin === <span class="string">'function'</span>) {</span><br><span class="line">        plugin.call(compiler, compiler)</span><br><span class="line">      } <span class="keyword">else</span> {</span><br><span class="line">        plugin.apply(compiler)</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 应用默认的Webpack配置</span></span><br><span class="line">  applyWebpackOptionsDefaults(options)</span><br><span class="line">  <span class="comment">// 随即之后，触发一些Hook</span></span><br><span class="line">  compiler.hooks.environment.call()</span><br><span class="line">  compiler.hooks.afterEnvironment.call()</span><br><span class="line">  <span class="comment">// 内置的Plugin的引入，对webpack options进行初始化</span></span><br><span class="line">  <span class="keyword">new</span> WebpackOptionsApply().process(options, compiler)</span><br><span class="line">  compiler.hooks.initialize.call()</span><br><span class="line">  <span class="keyword">return</span> compiler</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="编译阶段"><a href="#编译阶段" class="headerlink" title="编译阶段"></a>编译阶段</h4><ol>
<li>启动编译（<code>run/watch</code> 阶段）</li>
</ol>
<p>这里有个小逻辑区分是否是 <code>watch</code>，如果是非 <code>watch</code>，则会正常执行一次 <code>compiler.run()</code>。</p>
<p>如果是监听文件（如：<code>--watch</code>）的模式，则会传递监听的 <code>watchOptions</code>，生成 <code>Watching</code> 实例，每次变化都重新触发回调。</p>
<p>如果不是监视模式就调用 <code>Compiler</code> 对象的 <code>run</code> 方法，<code>befornRun->beforeCompile->compile->thisCompilation->compilation</code>开始构建整个应用。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> { SyncHook, SyncBailHook, AsyncSeriesHook } = <span class="built_in">require</span>(<span class="string">'tapable'</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>{</span><br><span class="line">  <span class="keyword">constructor</span>() {</span><br><span class="line">    <span class="comment">// 1. 定义生命周期钩子</span></span><br><span class="line">    <span class="keyword">this</span>.hooks = <span class="built_in">Object</span>.freeze({</span><br><span class="line">      <span class="comment">// ...只列举几个常用的常见钩子，更多hook就不列举了，有兴趣看源码</span></span><br><span class="line">      done: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">'stats'</span>]), <span class="comment">//一次编译完成后执行，回调参数：stats</span></span><br><span class="line">      beforeRun: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">'compiler'</span>]),</span><br><span class="line">      run: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">'compiler'</span>]), <span class="comment">//在编译器开始读取记录前执行</span></span><br><span class="line">      emit: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">'compilation'</span>]), <span class="comment">//在生成文件到output目录之前执行，回调参数： compilation</span></span><br><span class="line">      afterEmit: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">'compilation'</span>]), <span class="comment">//在生成文件到output目录之后执行</span></span><br><span class="line">      compilation: <span class="keyword">new</span> SyncHook([<span class="string">'compilation'</span>, <span class="string">'params'</span>]), <span class="comment">//在一次compilation创建后执行插件</span></span><br><span class="line">      beforeCompile: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">'params'</span>]),</span><br><span class="line">      compile: <span class="keyword">new</span> SyncHook([<span class="string">'params'</span>]), <span class="comment">//在一个新的compilation创建之前执行</span></span><br><span class="line">      make: <span class="keyword">new</span> AsyncParallelHook([<span class="string">'compilation'</span>]), <span class="comment">//完成一次编译之前执行</span></span><br><span class="line">      afterCompile: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">'compilation'</span>]),</span><br><span class="line">      watchRun: <span class="keyword">new</span> AsyncSeriesHook([<span class="string">'compiler'</span>]),</span><br><span class="line">      failed: <span class="keyword">new</span> SyncHook([<span class="string">'error'</span>]),</span><br><span class="line">      watchClose: <span class="keyword">new</span> SyncHook([]),</span><br><span class="line">      afterPlugins: <span class="keyword">new</span> SyncHook([<span class="string">'compiler'</span>]),</span><br><span class="line">      entryOption: <span class="keyword">new</span> SyncBailHook([<span class="string">'context'</span>, <span class="string">'entry'</span>]),</span><br><span class="line">    })</span><br><span class="line">    <span class="comment">// ...省略代码</span></span><br><span class="line">  }</span><br><span class="line">  newCompilation() {</span><br><span class="line">    <span class="comment">// 创建Compilation对象回调compilation相关钩子</span></span><br><span class="line">    <span class="keyword">const</span> compilation = <span class="keyword">new</span> Compilation(<span class="keyword">this</span>)</span><br><span class="line">    <span class="comment">//...一系列操作</span></span><br><span class="line">    <span class="keyword">this</span>.hooks.compilation.call(compilation, params) <span class="comment">//compilation对象创建完成</span></span><br><span class="line">    <span class="keyword">return</span> compilation</span><br><span class="line">  }</span><br><span class="line">  watch() {</span><br><span class="line">    <span class="comment">//如果运行在watch模式则执行watch方法，否则执行run方法</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.running) {</span><br><span class="line">      <span class="keyword">return</span> handler(<span class="keyword">new</span> ConcurrentCompilationError())</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">this</span>.running = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">this</span>.watchMode = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Watching(<span class="keyword">this</span>, watchOptions, handler)</span><br><span class="line">  }</span><br><span class="line">  run(callback) {</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.running) {</span><br><span class="line">      <span class="keyword">return</span> callback(<span class="keyword">new</span> ConcurrentCompilationError())</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">this</span>.running = <span class="literal">true</span></span><br><span class="line">    process.nextTick(<span class="function"><span class="params">()</span> =></span> {</span><br><span class="line">      <span class="keyword">this</span>.emitAssets(compilation, (err) => {</span><br><span class="line">        <span class="keyword">if</span> (err) {</span><br><span class="line">          <span class="comment">// 在编译和输出的流程中遇到异常时，会触发 failed 事件</span></span><br><span class="line">          <span class="keyword">this</span>.hooks.failed.call(err)</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (compilation.hooks.needAdditionalPass.call()) {</span><br><span class="line">          <span class="comment">// ...</span></span><br><span class="line">          <span class="comment">// done：完成编译</span></span><br><span class="line">          <span class="keyword">this</span>.hooks.done.callAsync(stats, (err) => {</span><br><span class="line">            <span class="comment">// 创建compilation对象之前</span></span><br><span class="line">            <span class="keyword">this</span>.compile(onCompiled)</span><br><span class="line">          })</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">this</span>.emitRecords(<span class="function">(<span class="params">err</span>) =></span> {</span><br><span class="line">          <span class="keyword">this</span>.hooks.done.callAsync(stats, (err) => {})</span><br><span class="line">        })</span><br><span class="line">      })</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.hooks.beforeRun.callAsync(<span class="keyword">this</span>, (err) => {</span><br><span class="line">      <span class="keyword">this</span>.hooks.run.callAsync(<span class="keyword">this</span>, (err) => {</span><br><span class="line">        <span class="keyword">this</span>.readRecords(<span class="function">(<span class="params">err</span>) =></span> {</span><br><span class="line">          <span class="keyword">this</span>.compile(onCompiled)</span><br><span class="line">        })</span><br><span class="line">      })</span><br><span class="line">    })</span><br><span class="line">  }</span><br><span class="line">  compile(callback) {</span><br><span class="line">    <span class="keyword">const</span> params = <span class="keyword">this</span>.newCompilationParams()</span><br><span class="line">    <span class="keyword">this</span>.hooks.beforeCompile.callAsync(params, (err) => {</span><br><span class="line">      <span class="keyword">this</span>.hooks.compile.call(params)</span><br><span class="line">      <span class="comment">//已完成complication的实例化</span></span><br><span class="line">      <span class="keyword">const</span> compilation = <span class="keyword">this</span>.newCompilation(params)</span><br><span class="line">      <span class="comment">//触发make事件并调用addEntry，找到入口js，进行下一步</span></span><br><span class="line">      <span class="comment">// make：表示一个新的complication创建完毕</span></span><br><span class="line">      <span class="keyword">this</span>.hooks.make.callAsync(compilation, (err) => {</span><br><span class="line">        process.nextTick(<span class="function"><span class="params">()</span> =></span> {</span><br><span class="line">          compilation.finish(<span class="function">(<span class="params">err</span>) =></span> {</span><br><span class="line">            <span class="comment">// 封装构建结果（seal），逐次对每个module和chunk进行整理，每个chunk对应一个入口文件</span></span><br><span class="line">            compilation.seal(<span class="function">(<span class="params">err</span>) =></span> {</span><br><span class="line">              <span class="keyword">this</span>.hooks.afterCompile.callAsync(compilation, (err) => {</span><br><span class="line">                <span class="comment">// 异步的事件需要在插件处理完任务时调用回调函数通知 Webpack 进入下一个流程，</span></span><br><span class="line">                <span class="comment">// 不然运行流程将会一直卡在这不往下执行</span></span><br><span class="line">                <span class="keyword">return</span> callback(<span class="literal">null</span>, compilation)</span><br><span class="line">              })</span><br><span class="line">            })</span><br><span class="line">          })</span><br><span class="line">        })</span><br><span class="line">      })</span><br><span class="line">    })</span><br><span class="line">  }</span><br><span class="line">  emitAssets() {}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ol start="2">
<li>编译模块：(<code>make</code> 阶段)</li>
</ol>
<ul>
<li>从 entry 入口配置文件出发, 调用所有配置的 <code>Loader</code> 对模块进行处理,</li>
<li>再找出该模块依赖的模块, 通过 <code>acorn</code> 库生成模块代码的 <code>AST</code> 语法树，形成依赖关系树（每个模块被处理后的最终内容以及它们之间的依赖关系），</li>
<li>根据语法树分析这个模块是否还有依赖的模块，如果有则继续循环每个依赖；再递归本步骤直到所有入口依赖的文件都经过了对应的 loader 处理。</li>
<li>解析结束后，<code>webpack</code> 会把所有模块封装在一个函数里，并放入一个名为 <code>modules</code> 的数组里。</li>
<li>将 <code>modules</code> 传入一个自执行函数中，自执行函数包含一个 <code>installedModules</code> 对象，已经执行的代码模块会保存在此对象中。</li>
<li>最后自执行函数中加载函数（<code>webpack__require</code>）载入模块。</li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compilation</span> <span class="keyword">extends</span> <span class="title">Tapable</span> </span>{</span><br><span class="line">	<span class="keyword">constructor</span>(compiler) {</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.hooks = {};</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">		<span class="keyword">this</span>.compiler = compiler;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">		<span class="comment">// 构建生成的资源</span></span><br><span class="line">		<span class="keyword">this</span>.chunks = [];</span><br><span class="line">		<span class="keyword">this</span>.chunkGroups = [];</span><br><span class="line">		<span class="keyword">this</span>.modules = [];</span><br><span class="line">		<span class="keyword">this</span>.additionalChunkAssets = [];</span><br><span class="line">		<span class="keyword">this</span>.assets = {};</span><br><span class="line">		<span class="keyword">this</span>.children = [];</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	}</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	buildModule(<span class="built_in">module</span>, optional, origin, dependencies, thisCallback) {</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">		<span class="comment">// 调用module.build方法进行编译代码，build中 其实是利用acorn编译生成AST</span></span><br><span class="line">		<span class="keyword">this</span>.hooks.buildModule.call(<span class="built_in">module</span>);</span><br><span class="line">		<span class="built_in">module</span>.build( <span class="comment">/**param*/</span> );</span><br><span class="line">	}</span><br><span class="line">	<span class="comment">// 将模块添加到列表中，并编译模块</span></span><br><span class="line">	_addModuleChain(context, dependency, onModule, callback) {</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">		<span class="comment">// moduleFactory.create创建模块，这里会先利用loader处理文件，然后生成模块对象</span></span><br><span class="line">		moduleFactory.create({</span><br><span class="line">			contextInfo: {</span><br><span class="line">				issuer: <span class="string">""</span>,</span><br><span class="line">				compiler: <span class="keyword">this</span>.compiler.name</span><br><span class="line">			},</span><br><span class="line">			context: context,</span><br><span class="line">			dependencies: [dependency]</span><br><span class="line">		}, (err, <span class="built_in">module</span>) = > {</span><br><span class="line">			<span class="keyword">const</span> addModuleResult = <span class="keyword">this</span>.addModule(<span class="built_in">module</span>);</span><br><span class="line">			<span class="built_in">module</span> = addModuleResult.module;</span><br><span class="line">			onModule(<span class="built_in">module</span>);</span><br><span class="line">			dependency.module = <span class="built_in">module</span>;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// ...</span></span><br><span class="line">			<span class="comment">// 调用buildModule编译模块</span></span><br><span class="line">			<span class="keyword">this</span>.buildModule(<span class="built_in">module</span>, <span class="literal">false</span>, <span class="literal">null</span>, <span class="literal">null</span>, err = > {});</span><br><span class="line">		});</span><br><span class="line">	}</span><br><span class="line">	<span class="comment">// 添加入口模块，开始编译&构建</span></span><br><span class="line">	addEntry(context, entry, name, callback) {</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">		<span class="keyword">this</span>._addModuleChain( <span class="comment">// 调用_addModuleChain添加模块</span></span><br><span class="line">		context, entry, <span class="built_in">module</span> = > {</span><br><span class="line">			<span class="keyword">this</span>.entries.push(<span class="built_in">module</span>);</span><br><span class="line">		},</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">		);</span><br><span class="line">	}</span><br><span class="line">	seal(callback) {</span><br><span class="line">		<span class="keyword">this</span>.hooks.seal.call();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">		<span class="comment">//完成了Chunk的构建和依赖、Chunk、module等各方面的优化</span></span><br><span class="line">		<span class="keyword">const</span> chunk = <span class="keyword">this</span>.addChunk(name);</span><br><span class="line">		<span class="keyword">const</span> entrypoint = <span class="keyword">new</span> Entrypoint(name);</span><br><span class="line">		entrypoint.setRuntimeChunk(chunk);</span><br><span class="line">		entrypoint.addOrigin(<span class="literal">null</span>, name, preparedEntrypoint.request);</span><br><span class="line">		<span class="keyword">this</span>.namedChunkGroups.set(name, entrypoint);</span><br><span class="line">		<span class="keyword">this</span>.entrypoints.set(name, entrypoint);</span><br><span class="line">		<span class="keyword">this</span>.chunkGroups.push(entrypoint);</span><br><span class="line"></span><br><span class="line">		GraphHelpers.connectChunkGroupAndChunk(entrypoint, chunk);</span><br><span class="line">		GraphHelpers.connectChunkAndModule(chunk, <span class="built_in">module</span>);</span><br><span class="line"></span><br><span class="line">		chunk.entryModule = <span class="built_in">module</span>;</span><br><span class="line">		chunk.name = name;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">		<span class="keyword">this</span>.hooks.beforeHash.call();</span><br><span class="line">		<span class="keyword">this</span>.createHash();</span><br><span class="line">		<span class="keyword">this</span>.hooks.afterHash.call();</span><br><span class="line">		<span class="keyword">this</span>.hooks.beforeModuleAssets.call();</span><br><span class="line">		<span class="keyword">this</span>.createModuleAssets();</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.hooks.shouldGenerateChunkAssets.call() !== <span class="literal">false</span>) {</span><br><span class="line">			<span class="keyword">this</span>.hooks.beforeChunkAssets.call();</span><br><span class="line">			<span class="keyword">this</span>.createChunkAssets();</span><br><span class="line">		}</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	createHash() {</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 生成 assets 资源并 保存到 Compilation.assets 中 给webpack写插件的时候会用到</span></span><br><span class="line">	createModuleAssets() {</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i < <span class="keyword">this</span>.modules.length; i++) {</span><br><span class="line">			<span class="keyword">const</span> <span class="built_in">module</span> = <span class="keyword">this</span>.modules[i];</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">module</span>.buildInfo.assets) {</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">const</span> assetName <span class="keyword">of</span> <span class="built_in">Object</span>.keys(<span class="built_in">module</span>.buildInfo.assets)) {</span><br><span class="line">					<span class="keyword">const</span> fileName = <span class="keyword">this</span>.getPath(assetName);</span><br><span class="line">					<span class="keyword">this</span>.assets[fileName] = <span class="built_in">module</span>.buildInfo.assets[assetName];</span><br><span class="line">					<span class="keyword">this</span>.hooks.moduleAsset.call(<span class="built_in">module</span>, fileName);</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	createChunkAssets() {</span><br><span class="line">		asyncLib.forEach(</span><br><span class="line">		<span class="keyword">this</span>.chunks, (chunk, callback) = > {</span><br><span class="line">			<span class="comment">// manifest是数组结构，每个manifest元素都提供了 `render` 方法，提供后续的源码字符串生成服务。至于render方法何时初始化的，在`./lib/MainTemplate.js`中</span></span><br><span class="line">			<span class="keyword">let</span> manifest = <span class="keyword">this</span>.getRenderManifest()</span><br><span class="line">			asyncLib.forEach(</span><br><span class="line">			manifest, (fileManifest, callback) = > {...</span><br><span class="line">				source = fileManifest.render()</span><br><span class="line">				<span class="keyword">this</span>.emitAsset(file, source, assetInfo)</span><br><span class="line">			}, callback)</span><br><span class="line">		}, callback)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingleEntryPlugin</span> </span>{</span><br><span class="line">  apply(compiler) {</span><br><span class="line">    compiler.hooks.compilation.tap(</span><br><span class="line">      <span class="string">'SingleEntryPlugin'</span>,</span><br><span class="line">      (compilation, { normalModuleFactory }) => {</span><br><span class="line">        compilation.dependencyFactories.set(</span><br><span class="line">          SingleEntryDependency,</span><br><span class="line">          normalModuleFactory</span><br><span class="line">        )</span><br><span class="line">      }</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    compiler.hooks.make.tapAsync(</span><br><span class="line">      <span class="string">'SingleEntryPlugin'</span>,</span><br><span class="line">      (compilation, callback) => {</span><br><span class="line">        <span class="keyword">const</span> { entry, name, context } = <span class="keyword">this</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> dep = SingleEntryPlugin.createDependency(entry, name)</span><br><span class="line">        compilation.addEntry(context, dep, name, callback)</span><br><span class="line">      }</span><br><span class="line">    )</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> createDependency(entry, name) {</span><br><span class="line">    <span class="keyword">const</span> dep = <span class="keyword">new</span> SingleEntryDependency(entry)</span><br><span class="line">    dep.loc = { name }</span><br><span class="line">    <span class="keyword">return</span> dep</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>概括一下 <code>make</code> 阶段单入口打包的流程，大致为 4 步骤</p>
<ol>
<li>执行 <code>SingleEntryPlugin</code>(单入口调用 <code>SingleEntryPlugin</code>，多入口调用 <code>MultiEntryPlugin</code>，异步调用 <code>DynamicEntryPlugin</code>)，<code>EntryPlugin</code> 方法中调用了 <code>Compilation.addEntry</code> 方法，添加入口模块，开始编译&构建</li>
<li><code>addEntry</code> 中调用 <code>_addModuleChain</code>,将模块添加到依赖列表中，并编译模块</li>
<li>然后在 <code>buildModule</code> 方法中，调用了 <code>NormalModule.build</code>，创建模块之时，会调用 <code>runLoaders</code>，执行 <code>Loader</code>，利用 <code>acorn</code> 编译生成 <code>AST</code></li>
<li>分析文件的依赖关系逐个拉取依赖模块并重复上述过程，最后将所有模块中的 <code>require</code> 语法替换成 <code>webpack_require</code> 来模拟模块化操作。</li>
</ol>
<h5 id="从源码的角度，思考一下，-loader-为什么是自右向左执行的，loader-中有-pitch-也会从右到左执行的么？"><a href="#从源码的角度，思考一下，-loader-为什么是自右向左执行的，loader-中有-pitch-也会从右到左执行的么？" class="headerlink" title="从源码的角度，思考一下， loader 为什么是自右向左执行的，loader 中有 pitch 也会从右到左执行的么？"></a>从源码的角度，思考一下， <code>loader</code> 为什么是自右向左执行的，<code>loader</code> 中有 <code>pitch</code> 也会从右到左执行的么？</h5><p><code>runLoaders</code> 方法调用 <code>iteratePitchingLoaders</code> 去递归查找执行有 <code>pich</code> 属性的 <code>loader</code> ；若存在多个 <code>pitch</code> 属性的 <code>loader</code> 则依次执行所有带 <code>pitch</code> 属性的 <code>loader</code> ，执行完后逆向执行所有带 <code>pitch</code> 属性的 <code>normal</code> 的 <code>normal loader</code> 后返回 <code>result</code>，没有 <code>pitch</code> 属性的 <code>loader</code> 就不会再执行；若 <code>loaders</code> 中没有 <code>pitch</code> 属性的 <code>loader</code> 则逆向执行 <code>loader；执行正常</code> loader 是在 <code>iterateNormalLoaders</code> 方法完成的，处理完所有 <code>loader</code> 后返回 <code>result</code>。</p>
<p>出自文章<a href="https://juejin.im/post/5bc1a73df265da0a8d36b74f" target="_blank" rel="noopener">你真的掌握了 loader 么？- loader 十问(https://juejin.im/post/5bc1a73df265da0a8d36b74f)</a></p>
<h5 id="Compiler-和-Compilation-的区别"><a href="#Compiler-和-Compilation-的区别" class="headerlink" title="Compiler 和 Compilation 的区别"></a>Compiler 和 Compilation 的区别</h5><p><code>webpack</code> 打包离不开 <code>Compiler</code> 和 <code>Compilation</code>,它们两个分工明确，理解它们是我们理清 <code>webpack</code> 构建流程重要的一步。</p>
<p><code>Compiler</code> 负责监听文件和启动编译<br>它可以读取到 <code>webpack</code> 的 config 信息，整个 <code>Webpack</code> 从启动到关闭的生命周期，一般只有一个 Compiler 实例，整个生命周期里暴露了很多方法，常见的 <code>run</code>,<code>make</code>,<code>compile</code>,<code>finish</code>,<code>seal</code>,<code>emit</code> 等，我们写的插件就是作用在这些暴露方法的 hook 上</p>
<p><code>Compilation</code> 负责构建编译。<br>每一次编译（文件只要发生变化，）就会生成一个 <code>Compilation</code> 实例，<code>Compilation</code> 可以读取到当前的模块资源，编译生成资源，变化的文件，以及依赖跟踪等状态信息。同时也提供很多事件回调给插件进行拓展。</p>
<h4 id="完成编译"><a href="#完成编译" class="headerlink" title="完成编译"></a>完成编译</h4><ol>
<li>输出资源：（seal 阶段）</li>
</ol>
<p>在编译完成后，调用 <code>compilation.seal</code> 方法封闭，生成资源，这些资源保存在 <code>compilation.assets</code>, <code>compilation.chunk</code>,然后便会调用 <code>emit</code> 钩子，根据 <code>webpack config</code> 文件的 <code>output</code> 配置的 <code>path</code> 属性，将文件输出到指定的 <code>path</code>.</p>
<ol start="2">
<li>输出完成：<code>done/failed</code> 阶段</li>
</ol>
<p><code>done</code> 成功完成一次完成的编译和输出流程。<br><code>failed</code> 编译失败，可以在本事件中获取到具体的错误原因<br>在确定好输出内容后, 根据配置确定输出的路径和文件名, 把文件内容写入到文件系统。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">emitAssets(compilation, callback) {</span><br><span class="line">    <span class="keyword">const</span> emitFiles = <span class="function">(<span class="params">err</span>) =></span> {</span><br><span class="line">      <span class="comment">//...省略一系列代码</span></span><br><span class="line">      <span class="comment">// afterEmit：文件已经写入磁盘完成</span></span><br><span class="line">      <span class="keyword">this</span>.hooks.afterEmit.callAsync(compilation, (err) => {</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err)</span><br><span class="line">        <span class="keyword">return</span> callback()</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// emit 事件发生时，可以读取到最终输出的资源、代码块、模块及其依赖，并进行修改(这是最后一次修改最终文件的机会)</span></span><br><span class="line">    <span class="keyword">this</span>.hooks.emit.callAsync(compilation, (err) => {</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err)</span><br><span class="line">      outputPath = compilation.getPath(<span class="keyword">this</span>.outputPath, {})</span><br><span class="line">      mkdirp(<span class="keyword">this</span>.outputFileSystem, outputPath, emitFiles)</span><br><span class="line">    })</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>
<p>然后，我们来看一下 webpack 打包好的代码是什么样子的。</p>
<h3 id="webpack-输出文件代码分析"><a href="#webpack-输出文件代码分析" class="headerlink" title="webpack 输出文件代码分析"></a>webpack 输出文件代码分析</h3><p>未压缩的 bundle.js 文件结构一般如下：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="function"><span class="keyword">function</span> (<span class="params">modules</span>) </span>{</span><br><span class="line">  <span class="comment">// webpackBootstrap</span></span><br><span class="line">  <span class="comment">// 缓存 __webpack_require__ 函数加载过的模块，提升性能，</span></span><br><span class="line">  <span class="keyword">var</span> installedModules = {}</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Webpack 加载函数，用来加载 webpack 定义的模块</span></span><br><span class="line"><span class="comment">   * @param {String} moduleId 模块 ID，一般为模块的源码路径，如 "./src/index.js"</span></span><br><span class="line"><span class="comment">   * @returns {Object} exports 导出对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>{</span><br><span class="line">    <span class="comment">// 重复加载则利用缓存，有则直接从缓存中取得</span></span><br><span class="line">    <span class="keyword">if</span> (installedModules[moduleId]) {</span><br><span class="line">      <span class="keyword">return</span> installedModules[moduleId].exports</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 如果是第一次加载，则初始化模块对象，并缓存</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">module</span> = (installedModules[moduleId] = {</span><br><span class="line">      i: moduleId,</span><br><span class="line">      l: <span class="literal">false</span>,</span><br><span class="line">      exports: {},</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把要加载的模块内容，挂载到module.exports上</span></span><br><span class="line">    modules[moduleId].call(</span><br><span class="line">      <span class="built_in">module</span>.exports,</span><br><span class="line">      <span class="built_in">module</span>,</span><br><span class="line">      <span class="built_in">module</span>.exports,</span><br><span class="line">      __webpack_require__</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">module</span>.l = <span class="literal">true</span> <span class="comment">// 标记为已加载</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回加载的模块，直接调用即可</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">module</span>.exports</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// 在 __webpack_require__ 函数对象上挂载一些变量及函数 ...</span></span><br><span class="line">  __webpack_require__.m = modules</span><br><span class="line">  __webpack_require__.c = installedModules</span><br><span class="line">  __webpack_require__.d = <span class="function"><span class="keyword">function</span> (<span class="params">exports, name, getter</span>) </span>{</span><br><span class="line">    <span class="keyword">if</span> (!__webpack_require__.o(exports, name)) {</span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(exports, name, {</span><br><span class="line">        enumerable: <span class="literal">true</span>,</span><br><span class="line">        get: getter,</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  __webpack_require__.n = <span class="function"><span class="keyword">function</span> (<span class="params">module</span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> getter =</span><br><span class="line">      <span class="built_in">module</span> && <span class="built_in">module</span>.__esModule</span><br><span class="line">        ? <span class="function"><span class="keyword">function</span> <span class="title">getDefault</span>(<span class="params"></span>) </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">module</span>[<span class="string">'default'</span>]</span><br><span class="line">          }</span><br><span class="line">        : <span class="function"><span class="keyword">function</span> <span class="title">getModuleExports</span>(<span class="params"></span>) </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">module</span></span><br><span class="line">          }</span><br><span class="line">    __webpack_require__.d(getter, <span class="string">'a'</span>, getter)</span><br><span class="line">    <span class="keyword">return</span> getter</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// __webpack_require__对象下的r函数</span></span><br><span class="line">  <span class="comment">// 在module.exports上定义__esModule为true，表明是一个模块对象</span></span><br><span class="line">  __webpack_require__.r = <span class="function"><span class="keyword">function</span> (<span class="params">exports</span>) </span>{</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">Symbol</span> !== <span class="string">'undefined'</span> && <span class="built_in">Symbol</span>.toStringTag) {</span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(exports, <span class="built_in">Symbol</span>.toStringTag, {</span><br><span class="line">        value: <span class="string">'Module'</span>,</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(exports, <span class="string">'__esModule'</span>, {</span><br><span class="line">      value: <span class="literal">true</span>,</span><br><span class="line">    })</span><br><span class="line">  }</span><br><span class="line">  __webpack_require__.o = <span class="function"><span class="keyword">function</span> (<span class="params">object, property</span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.hasOwnProperty.call(object, property)</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//  从入口文件开始执行</span></span><br><span class="line">  <span class="keyword">return</span> __webpack_require__((__webpack_require__.s = <span class="string">'./src/index.js'</span>))</span><br><span class="line">})({</span><br><span class="line">  <span class="string">'./src/index.js'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    module,</span></span></span><br><span class="line"><span class="function"><span class="params">    __webpack_exports__,</span></span></span><br><span class="line"><span class="function"><span class="params">    __webpack_require__</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>) </span>{</span><br><span class="line"><span class="meta">    'use strict'</span></span><br><span class="line">    <span class="built_in">eval</span>(</span><br><span class="line">      <span class="string">'__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _moduleA__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./moduleA */ "./src/moduleA.js");\n/* harmony import */ var _moduleA__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_moduleA__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _moduleB__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./moduleB */ "./src/moduleB.js");\n/* harmony import */ var _moduleB__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_moduleB__WEBPACK_IMPORTED_MODULE_1__);\n\n\n\n//# sourceURL=webpack:///./src/index.js?'</span></span><br><span class="line">    )</span><br><span class="line">  },</span><br><span class="line">  <span class="string">'./src/moduleA.js'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, exports</span>) </span>{</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">'console.log("moduleA")\n\n//# sourceURL=webpack:///./src/moduleA.js?'</span>)</span><br><span class="line">  },</span><br><span class="line">  <span class="string">'./src/moduleB.js'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, exports</span>) </span>{</span><br><span class="line">    <span class="comment">// 代码字符串可以通过eval 函数运行</span></span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">'console.log("moduleB")\n\n//# sourceURL=webpack:///./src/moduleB.js?'</span>)</span><br><span class="line">  },</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<p>上述代码的实现了⼀个 <code>webpack_require</code> 来实现⾃⼰的模块化把代码都缓存在 <code>installedModules</code> ⾥，代码⽂件以对象传递进来，<code>key</code> 是路径，<code>value</code> 是包裹的代码字符串，并且代码内部的 <code>require</code>，都被替换成了 <code>webpack_require</code>,代码字符串可以通过 eval 函数去执行。</p>
<p><code>bundle.js</code> 能直接运行在浏览器中的原因在于输出的文件中通过 <strong>webpack_require</strong> 函数定义了一个可以在浏览器中执行的加载函数来模拟 <code>Node.js</code> 中的 <code>require</code> 语句。</p>
<p>总结一下，生成的 <code>bundle.js</code>只包含一个立即调用函数（IIFE），这个函数会接受一个对象为参数，它其实主要做了两件事：</p>
<ol>
<li><p>定义一个模块加载函数 <code>webpack_require。</code></p>
</li>
<li><p>使用加载函数加载入口模块 <code>"./src/index.js"</code>，从入口文件开始递归解析依赖，在解析的过程中，分别对不同的模块进行处理，返回模块的 <code>exports</code>。</p>
</li>
</ol>
<p>所以我们只需要实现 2 个功能就可以实现一个简单的仿 <code>webpack</code> 打包 <code>js</code> 的编译工具</p>
<ol>
<li>从入口开始递归分析依赖</li>
<li>借助依赖图谱来生成真正能在浏览器上运行的代码</li>
</ol>
<h3 id="实现一个简单的-webpack"><a href="#实现一个简单的-webpack" class="headerlink" title="实现一个简单的 webpack"></a>实现一个简单的 webpack</h3><p>接下来从 0 开始实践一个 <code>Webpack</code> 的雏形，能够让大家更加深入了解 <code>Webpack</code></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">'@babel/parser'</span>) <span class="comment">//解析成ast</span></span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">'@babel/traverse'</span>).default <span class="comment">//遍历ast</span></span><br><span class="line"><span class="keyword">const</span> { transformFromAst } = <span class="built_in">require</span>(<span class="string">'@babel/core'</span>) <span class="comment">//ES6转换ES5</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">Webpack</span> </span>{</span><br><span class="line">  <span class="keyword">constructor</span>(options) {</span><br><span class="line">    <span class="keyword">const</span> { entry, output } = options</span><br><span class="line">    <span class="keyword">this</span>.entry = entry</span><br><span class="line">    <span class="keyword">this</span>.output = output</span><br><span class="line">    <span class="keyword">this</span>.modulesArr = []</span><br><span class="line">  }</span><br><span class="line">  run() {</span><br><span class="line">    <span class="keyword">const</span> info = <span class="keyword">this</span>.build(<span class="keyword">this</span>.entry)</span><br><span class="line">    <span class="keyword">this</span>.modulesArr.push(info)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i < <span class="keyword">this</span>.modulesArr.length; i++) {</span><br><span class="line">      <span class="comment">// 判断有依赖对象,递归解析所有依赖项</span></span><br><span class="line">      <span class="keyword">const</span> item = <span class="keyword">this</span>.modulesArr[i]</span><br><span class="line">      <span class="keyword">const</span> { dependencies } = item</span><br><span class="line">      <span class="keyword">if</span> (dependencies) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j <span class="keyword">in</span> dependencies) {</span><br><span class="line">          <span class="keyword">this</span>.modulesArr.push(<span class="keyword">this</span>.build(dependencies[j]))</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//数组结构转换</span></span><br><span class="line">    <span class="keyword">const</span> obj = {}</span><br><span class="line">    <span class="keyword">this</span>.modulesArr.forEach(<span class="function">(<span class="params">item</span>) =></span> {</span><br><span class="line">      obj[item.entryFile] = {</span><br><span class="line">        dependencies: item.dependencies,</span><br><span class="line">        code: item.code,</span><br><span class="line">      }</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">this</span>.emitFile(obj)</span><br><span class="line">  }</span><br><span class="line">  build(entryFile) {</span><br><span class="line">    <span class="keyword">const</span> conts = fs.readFileSync(entryFile, <span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">const</span> ast = parser.parse(conts, {</span><br><span class="line">      sourceType: <span class="string">'module'</span>,</span><br><span class="line">    })</span><br><span class="line">    <span class="comment">//  console.log(ast)</span></span><br><span class="line">    <span class="comment">// 遍历所有的 import 模块,存入dependecies</span></span><br><span class="line">    <span class="keyword">const</span> dependencies = {}</span><br><span class="line">    traverse(ast, {</span><br><span class="line">      <span class="comment">//  类型为 ImportDeclaration 的 AST 节点，</span></span><br><span class="line">      <span class="comment">// 其实就是我们的 import xxx from xxxx</span></span><br><span class="line">      ImportDeclaration({ node }) {</span><br><span class="line">        <span class="keyword">const</span> newPath =</span><br><span class="line">          <span class="string">'./'</span> + path.join(path.dirname(entryFile), node.source.value)</span><br><span class="line">        dependencies[node.source.value] = newPath</span><br><span class="line">        <span class="comment">// console.log(dependencies)</span></span><br><span class="line">      },</span><br><span class="line">    })</span><br><span class="line">    <span class="comment">// 将转化后 ast 的代码重新转化成代码</span></span><br><span class="line">    <span class="comment">// 并通过配置 @babel/preset-env 预置插件编译成 es5</span></span><br><span class="line">    <span class="keyword">const</span> { code } = transformFromAst(ast, <span class="literal">null</span>, {</span><br><span class="line">      presets: [<span class="string">'@babel/preset-env'</span>],</span><br><span class="line">    })</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">      entryFile,</span><br><span class="line">      dependencies,</span><br><span class="line">      code,</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  emitFile(code) {</span><br><span class="line">    <span class="comment">//生成bundle.js</span></span><br><span class="line">    <span class="keyword">const</span> filePath = path.join(<span class="keyword">this</span>.output.path, <span class="keyword">this</span>.output.filename)</span><br><span class="line">    <span class="keyword">const</span> newCode = <span class="built_in">JSON</span>.stringify(code)</span><br><span class="line">    <span class="keyword">const</span> bundle = <span class="string">`(function(modules){</span></span><br><span class="line"><span class="string">           // moduleId 为传入的 filename ，即模块的唯一标识符</span></span><br><span class="line"><span class="string">            function require(moduleId){</span></span><br><span class="line"><span class="string">                function localRequire(relativePath){</span></span><br><span class="line"><span class="string">                   return require(modules[moduleId].dependencies[relativePath]) </span></span><br><span class="line"><span class="string">                }</span></span><br><span class="line"><span class="string">                var exports = {};</span></span><br><span class="line"><span class="string">                (function(require,exports,code){</span></span><br><span class="line"><span class="string">                    eval(code)</span></span><br><span class="line"><span class="string">                })(localRequire,exports,modules[moduleId].code)</span></span><br><span class="line"><span class="string">                return exports;</span></span><br><span class="line"><span class="string">            }</span></span><br><span class="line"><span class="string">            require('<span class="subst">${<span class="keyword">this</span>.entry}</span>')</span></span><br><span class="line"><span class="string">        })(<span class="subst">${newCode}</span>)`</span></span><br><span class="line">    fs.writeFileSync(filePath, bundle, <span class="string">'utf-8'</span>)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>调用</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">let</span> { resolve } = path</span><br><span class="line"><span class="keyword">let</span> webpackConfig = <span class="built_in">require</span>(path.resolve(<span class="string">'webpack.config.js'</span>))</span><br><span class="line"><span class="keyword">let</span> Webpack = <span class="built_in">require</span>(<span class="string">'./myWebpack.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultConfig = {</span><br><span class="line">  entry: <span class="string">'src/index.js'</span>,</span><br><span class="line">  output: {</span><br><span class="line">    path: resolve(__dirname, <span class="string">'../dist'</span>),</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">  },</span><br><span class="line">}</span><br><span class="line"><span class="keyword">const</span> config = {</span><br><span class="line">  ...defaultConfig,</span><br><span class="line">  ...webpackConfig,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = <span class="built_in">require</span>(<span class="string">'./webpack.config'</span>)</span><br><span class="line"><span class="keyword">new</span> Webpack(options).run()</span><br></pre></td></tr></tbody></table></figure>
<p>输入到浏览器看一下执行结果<br><img src="https://cdn.6fed.com/github/webpack/webpack/my-webpack-done.jpg" alt="my-webpack执行结果"></p>
<p>参考：</p>
<ol>
<li><a href="https://juejin.im/post/5e0d52716fb9a047f0002407" target="_blank" rel="noopener">快狗打车：实现一个简单的 <code>webpack</code></a></li>
<li><a href="https://juejin.im/post/5beb8875e51d455e5c4dd83f#heading-5" target="_blank" rel="noopener"><code>tapable</code> 详解+<code>webpack</code> 流程</a></li>
<li><a href="https://github.com/6fedcom/fe-blog/tree/master/webpack/webpack" target="_blank" rel="noopener">本文调试以及打断点用到的源码</a></li>
</ol>

            <div class="post-copyright">
    <div class="content">
        <!-- <p>最后更新： 2020年08月30日 21:54</p> -->
        <p>转载请保持原始链接</p>
        <p>原始链接： <a class="post-url" href="/note/d4691e78.html" title="webpack原理以及主流程源码阅读">https://ru23.com/note/d4691e78.html</a></p>
        <footer>
            <a href="https://ru23.com">
                <img src="//cdn.ru23.com/img/images/chrome.png" alt="frank">
                frank
            </a>
        </footer>
    </div>
</div>

            
            
            

            
        </div>
        <footer class="article-footer">
            
            
<div class="post-share">
    <a href="javascript:;" id="share-sub" class="post-share-fab">
        <i class="fa fa-share-alt"></i>
    </a>
    <div class="post-share-list" id="share-list">
        <ul class="share-icons">
          <li>
            <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://ru23.com/note/d4691e78.html&title=《webpack原理以及主流程源码阅读》 — 前端迷&pic=//cdn.ru23.com/img/images/chrome.png" data-title="微博">
              <i class="fa fa-weibo"></i>
            </a>
          </li>
          <li>
            <a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信">
              <i class="fa fa-weixin"></i>
            </a>
          </li>
          <li>
            <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://ru23.com/note/d4691e78.html&title=《webpack原理以及主流程源码阅读》 — 前端迷&source=frank，前端开发爱好者，沉迷前端，无法自拔,欢迎一切技术交流（不局限于前端），邮箱fanqianweb@gmail.com" data-title="QQ">
              <i class="fa fa-qq"></i>
            </a>
          </li>
          <li>
            <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://ru23.com/note/d4691e78.html" data-title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li>
            <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《webpack原理以及主流程源码阅读》 — 前端迷&url=https://ru23.com/note/d4691e78.html&via=https://ru23.com" data-title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li>
            <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://ru23.com/note/d4691e78.html" data-title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
     </div>
</div>
<div class="post-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" id="wxShare-close">×</a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAAByElEQVR42u3aQW7DMAwEwPz/0+25aJ0syYgxivGpCGJp0oMgLvl4xM9X8fn97tWajxMPLi7umJtsPP/O1ffz9XFxcfe5zw+a5Hh6Tqmuf/k5Li7uLbnVw+v5LQUXF/d/cPMCJrkM4eLi3plbLVSuNk5WXqrVcHFxB9w8pTz395F8FxcXt8XtNUjyQGReOP3YHRcXd4WbHyiT1khSDiX74uLi7nCT13qFUF4g5evg4uJucqPTrliDVCOS6LjExcVd504iywRabZn88RYuLu46NylOkvijukK+Ji4u7ia3NySRs/JBjUKthouLu8KdJA+9SCX/2ZeBKS4u7jFuNezIj6SkrVK4+uDi4i5y86bpPEBJmi6j4gcXF3fMnQxoVscyqsVPYawTFxf3ADePMPKgJPkkb728GMLAxcU9xq22P98VeZTDFFxc3BtwqyNZvTAlb7rg4uKe5vY2noeh+XUHFxd3n9trl+bbVIe03tXcxcXFnXOrF5TeOFe1iLr8d+Di4i5y592YnFgtfl7ku7i4uDfj9tquUTBaTU1wcXE/ys2D115g+kKIi4u7yM1Lml6c2hvdwMXF/RS3epT0rj694HWU7+Li4na43wa+2FclMNMmAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>

<div class="mask"></div>

            
            <ul class="article-footer-menu">
                
                
  <li class="article-footer-tags">
    <i class="fa fa-tags"></i>
      
    <a href="/tags/webpack/" class="color3">webpack</a>
      
  </li>

            </ul>
            
        </footer>
    </div>
</article>


    <aside class="post-toc-pos post-toc-top" id="post-toc">
        <nav class="post-toc-wrap">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#简单概述-Webpack-整体运行流程"><span class="post-toc-text">简单概述 Webpack 整体运行流程</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#webpack-打包主流程源码阅读"><span class="post-toc-text">webpack 打包主流程源码阅读</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#初始化阶段"><span class="post-toc-text">初始化阶段</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#编译阶段"><span class="post-toc-text">编译阶段</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#从源码的角度，思考一下，-loader-为什么是自右向左执行的，loader-中有-pitch-也会从右到左执行的么？"><span class="post-toc-text">从源码的角度，思考一下， loader 为什么是自右向左执行的，loader 中有 pitch 也会从右到左执行的么？</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Compiler-和-Compilation-的区别"><span class="post-toc-text">Compiler 和 Compilation 的区别</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#完成编译"><span class="post-toc-text">完成编译</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#webpack-输出文件代码分析"><span class="post-toc-text">webpack 输出文件代码分析</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实现一个简单的-webpack"><span class="post-toc-text">实现一个简单的 webpack</span></a></li></ol>
        </nav>
    </aside>
    

<nav id="article-nav">
  
  
    <a href="/note/9f79cea2.html" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">揭秘webpack插件工作流程和原理</span>
      <i class="fa fa-hand-o-right" aria-hidden="true"></i>
    </a>
  
</nav>




<!-- Valine Comments -->
<div class="comments vcomment" id="comments"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
<!-- Valine Comments script -->
<script>
    var GUEST_INFO = ['nick', 'mail', 'link'];
    var guest_info = 'nick,mail,link'.split(',').filter(function (item) {
        return GUEST_INFO.indexOf(item) > -1
    });
    new Valine({
        el: '#comments',
        notify: 'true' == 'true',
        verify: 'false' == 'true',
        appId: "OOiJvCREqswvpnTL4RuSShLq-gzGzoHsz",
        appKey: "OPfVBB2YjMrT3ngcc8mu6w8g",
        avatar: "mm",
        qrcode: "",
        placeholder: "输入评论...",
        guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
        pageSize: "10"
    })
</script>
<!-- Valine Comments end -->

</section>
        <div class="outer-ad-aside" id="outer-ad-aside">
          
          
          <a style="display: block;" title="阿里云双十二大促，新老用户皆可返现" target="_blank" href="https://www.aliyun.com/minisite/goods?userCode=jh5fwy2j&share_source=copy_link">
            
            <div class="ad-text" style="text-align:center;color: red;">
              阿里云双十二大促，新老用户皆可返现
            </div>
            
            <img src="https://img.alicdn.com/tfs/TB1_rYHo7P2gK0jSZPxXXacQpXa-690-388.jpg" alt="阿里云双十二大促，新老用户皆可返现">
          </a>
          
          <a style="display: block;" title="【腾讯云】云产品采购季，助力行业复工。1核2G云服务器，首年99元" target="_blank" href="https://cloud.tencent.com/act/cps/redirect?redirect=1067&cps_key=3bd05bbfb4f3f97d7bb5964ef12edda9&from=console">
            
            <div class="ad-text" style="text-align:center;color: red;">
              【腾讯云】云产品采购季，助力行业复工。1核2G云服务器，首年99元
            </div>
            
            <img src="https://upload-dianshi-1255598498.file.myqcloud.com/345x200-c37e147ab2b4b8074e63d71ca21420cf1a7d4933.png" alt="【腾讯云】云产品采购季，助力行业复工。1核2G云服务器，首年99元">
          </a>
          
          <a style="display: block;" title="微信公众号：前端迷" target="_blank" ">
            
            <img src="//cdn.ru23.com/hexo/public/wechat-mp.png" alt>
          </a>
          
          <a style="display: block;" title="微信前端技术交流群" target="_blank" ">
            
            <img src="//cdn.ru23.com/hexo/public/group.png" alt>
          </a>
          
          <a style="display: block;" target="_blank" ">
            
            <div class="ad-text" style="text-align:center;color: red;">
              广告位出售，日ip100+，联系vx:qianduanmi,备注广告，价格5元/月，随时上线
            </div>
            
            <img src=" https://cdn.ru23.com/common/sale.png" alt="广告位出售，日ip100+，联系vx:qianduanmi,备注广告，价格5元/月，随时上线">
          </a>
          
          
        </div>
      </div>
      
    </div>
    <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            
<p>
    <span id="busuanzi_container_site_uv" style="display:none">
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style="display:none">
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>



                <p>
                    CDN 存储在
                    <a href="https://console.upyun.com/register/?invite=SJ3dme4q8" target="_blank">
                        <style>
                            .upyun0box {
                                width: 14px;
                                height: 14px;
                                position: relative;
                                top: 3px;
                            }
                        </style>
                        <img class="upyun0box" src="https://www.upyun.com/static/favicon-64x64.png"> 又拍云
                    </a>
                    <br>
                </p>
                <p>
                    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> 主题是 <a href="https://github.com/6fedcom/fe-hexo-blog" target="_blank">基于MiHo主题优化</a> ©
                    2020
                        frank<br>
                </p>
        </div>
    </div>
</footer>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="https://js.fundebug.cn/fundebug.1.5.1.min.js" apikey="912ba8d8c6f372862c218e996a28cebb732bbb78559e974fc031204c813142f9"></script>
<script>
  var mihoConfig = {
    root: "https://ru23.com",
    animate: false,
    isHome: false,
    share: true,
    reward: 2
  }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-tag" title="Tags">
        <i class="fa fa-tags"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            <a class="category-link" href="/categories/algorithm/">algorithm</a><a class="category-link" href="/categories/back-end/">back-end</a><a class="category-link" href="/categories/fed-shared/">fed-shared</a><a class="category-link" href="/categories/front-end/">front-end</a><a class="category-link" href="/categories/hexo/">hexo</a><a class="category-link" href="/categories/tools/">tools</a><a class="category-link" href="/categories/前端自动化/">前端自动化</a>
        </div>
        <div id="sidebar-menu-box-tags">
            <a href="/tags/CSS/" style="font-size: 13.08px;">CSS</a> <a href="/tags/Emmet/" style="font-size: 10px;">Emmet</a> <a href="/tags/HTTP/" style="font-size: 10.77px;">HTTP</a> <a href="/tags/Immutable/" style="font-size: 11.54px;">Immutable</a> <a href="/tags/MVC/" style="font-size: 10px;">MVC</a> <a href="/tags/Snippet/" style="font-size: 13.08px;">Snippet</a> <a href="/tags/Vue/" style="font-size: 13.08px;">Vue</a> <a href="/tags/ajax/" style="font-size: 11.54px;">ajax</a> <a href="/tags/angular/" style="font-size: 10px;">angular</a> <a href="/tags/api/" style="font-size: 12.31px;">api</a> <a href="/tags/atom/" style="font-size: 10px;">atom</a> <a href="/tags/axios/" style="font-size: 12.31px;">axios</a> <a href="/tags/bootstrap/" style="font-size: 10.77px;">bootstrap</a> <a href="/tags/canvas/" style="font-size: 11.54px;">canvas</a> <a href="/tags/cookie/" style="font-size: 10px;">cookie</a> <a href="/tags/css/" style="font-size: 16.15px;">css</a> <a href="/tags/dom/" style="font-size: 13.08px;">dom</a> <a href="/tags/dva/" style="font-size: 11.54px;">dva</a> <a href="/tags/echart/" style="font-size: 10px;">echart</a> <a href="/tags/editconfig/" style="font-size: 10px;">editconfig</a> <a href="/tags/es6/" style="font-size: 13.85px;">es6</a> <a href="/tags/eslint/" style="font-size: 10.77px;">eslint</a> <a href="/tags/fed-shared/" style="font-size: 11.54px;">fed-shared</a> <a href="/tags/fetch/" style="font-size: 10px;">fetch</a> <a href="/tags/flex/" style="font-size: 10px;">flex</a> <a href="/tags/front-end/" style="font-size: 10px;">front-end</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/github/" style="font-size: 12.31px;">github</a> <a href="/tags/gulp/" style="font-size: 10.77px;">gulp</a> <a href="/tags/hexo/" style="font-size: 10.77px;">hexo</a> <a href="/tags/hide/" style="font-size: 10.77px;">hide</a> <a href="/tags/html5/" style="font-size: 16.92px;">html5</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/hybrid/" style="font-size: 10px;">hybrid</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/jquery/" style="font-size: 17.69px;">jquery</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/js代码片段/" style="font-size: 12.31px;">js代码片段</a> <a href="/tags/mock/" style="font-size: 10px;">mock</a> <a href="/tags/ms/" style="font-size: 10px;">ms</a> <a href="/tags/mvvm/" style="font-size: 11.54px;">mvvm</a> <a href="/tags/nginx/" style="font-size: 12.31px;">nginx</a> <a href="/tags/node/" style="font-size: 13.85px;">node</a> <a href="/tags/npm/" style="font-size: 13.08px;">npm</a> <a href="/tags/promise/" style="font-size: 10px;">promise</a> <a href="/tags/react/" style="font-size: 19.23px;">react</a> <a href="/tags/redux/" style="font-size: 13.08px;">redux</a> <a href="/tags/sublime/" style="font-size: 15.38px;">sublime</a> <a href="/tags/svn/" style="font-size: 10.77px;">svn</a> <a href="/tags/taro/" style="font-size: 10px;">taro</a> <a href="/tags/todolist/" style="font-size: 10px;">todolist</a> <a href="/tags/video/" style="font-size: 10px;">video</a> <a href="/tags/vscode/" style="font-size: 11.54px;">vscode</a> <a href="/tags/vue/" style="font-size: 18.46px;">vue</a> <a href="/tags/vuex/" style="font-size: 10.77px;">vuex</a> <a href="/tags/webpack/" style="font-size: 15.38px;">webpack</a> <a href="/tags/webstorm/" style="font-size: 10px;">webstorm</a> <a href="/tags/xhtml/" style="font-size: 10px;">xhtml</a> <a href="/tags/中间件/" style="font-size: 10px;">中间件</a> <a href="/tags/事件/" style="font-size: 10px;">事件</a> <a href="/tags/事件流/" style="font-size: 10px;">事件流</a> <a href="/tags/优质文章分享/" style="font-size: 11.54px;">优质文章分享</a> <a href="/tags/作用域/" style="font-size: 10px;">作用域</a> <a href="/tags/前端优化/" style="font-size: 10.77px;">前端优化</a> <a href="/tags/前端基础/" style="font-size: 10px;">前端基础</a> <a href="/tags/前端自动化/" style="font-size: 10px;">前端自动化</a> <a href="/tags/前端规范/" style="font-size: 14.62px;">前端规范</a> <a href="/tags/原型链/" style="font-size: 10px;">原型链</a> <a href="/tags/小程序/" style="font-size: 13.85px;">小程序</a> <a href="/tags/居中/" style="font-size: 10px;">居中</a> <a href="/tags/异步回调/" style="font-size: 10px;">异步回调</a> <a href="/tags/微信开发/" style="font-size: 11.54px;">微信开发</a> <a href="/tags/快应用/" style="font-size: 10px;">快应用</a> <a href="/tags/性能优化/" style="font-size: 10px;">性能优化</a> <a href="/tags/排序算法/" style="font-size: 10px;">排序算法</a> <a href="/tags/最佳实践/" style="font-size: 10px;">最佳实践</a> <a href="/tags/正则表达式/" style="font-size: 10.77px;">正则表达式</a> <a href="/tags/测试/" style="font-size: 10px;">测试</a> <a href="/tags/知识点/" style="font-size: 11.54px;">知识点</a> <a href="/tags/移动端/" style="font-size: 13.08px;">移动端</a> <a href="/tags/组件化/" style="font-size: 10px;">组件化</a> <a href="/tags/继承/" style="font-size: 10.77px;">继承</a> <a href="/tags/缓存/" style="font-size: 10px;">缓存</a> <a href="/tags/读书笔记/" style="font-size: 10.77px;">读书笔记</a> <a href="/tags/跨域/" style="font-size: 11.54px;">跨域</a> <a href="/tags/踩过的坑/" style="font-size: 16.92px;">踩过的坑</a> <a href="/tags/适配/" style="font-size: 10px;">适配</a> <a href="/tags/速查表/" style="font-size: 10px;">速查表</a> <a href="/tags/部署/" style="font-size: 10.77px;">部署</a> <a href="/tags/闭包/" style="font-size: 10px;">闭包</a> <a href="/tags/面向对象/" style="font-size: 10.77px;">面向对象</a> <a href="/tags/面试/" style="font-size: 12.31px;">面试</a> <a href="/tags/高阶函数/" style="font-size: 10.77px;">高阶函数</a>
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">×</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a target="_blank" href="https://58fe.com">
                    <i class="fa fa-heart"></i><span>前端社区</span>
                </a>
            </li>
            
            <li>
                <a href="/">
                    <i class="fa fa-home"></i><span>主页</span>
                </a>
            </li>
            
            <li>
                <a href="/archives">
                    <i class="fa fa-archive"></i><span>归档</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            <a href="/tags/CSS/" style="font-size: 13.08px;">CSS</a> <a href="/tags/Emmet/" style="font-size: 10px;">Emmet</a> <a href="/tags/HTTP/" style="font-size: 10.77px;">HTTP</a> <a href="/tags/Immutable/" style="font-size: 11.54px;">Immutable</a> <a href="/tags/MVC/" style="font-size: 10px;">MVC</a> <a href="/tags/Snippet/" style="font-size: 13.08px;">Snippet</a> <a href="/tags/Vue/" style="font-size: 13.08px;">Vue</a> <a href="/tags/ajax/" style="font-size: 11.54px;">ajax</a> <a href="/tags/angular/" style="font-size: 10px;">angular</a> <a href="/tags/api/" style="font-size: 12.31px;">api</a> <a href="/tags/atom/" style="font-size: 10px;">atom</a> <a href="/tags/axios/" style="font-size: 12.31px;">axios</a> <a href="/tags/bootstrap/" style="font-size: 10.77px;">bootstrap</a> <a href="/tags/canvas/" style="font-size: 11.54px;">canvas</a> <a href="/tags/cookie/" style="font-size: 10px;">cookie</a> <a href="/tags/css/" style="font-size: 16.15px;">css</a> <a href="/tags/dom/" style="font-size: 13.08px;">dom</a> <a href="/tags/dva/" style="font-size: 11.54px;">dva</a> <a href="/tags/echart/" style="font-size: 10px;">echart</a> <a href="/tags/editconfig/" style="font-size: 10px;">editconfig</a> <a href="/tags/es6/" style="font-size: 13.85px;">es6</a> <a href="/tags/eslint/" style="font-size: 10.77px;">eslint</a> <a href="/tags/fed-shared/" style="font-size: 11.54px;">fed-shared</a> <a href="/tags/fetch/" style="font-size: 10px;">fetch</a> <a href="/tags/flex/" style="font-size: 10px;">flex</a> <a href="/tags/front-end/" style="font-size: 10px;">front-end</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/github/" style="font-size: 12.31px;">github</a> <a href="/tags/gulp/" style="font-size: 10.77px;">gulp</a> <a href="/tags/hexo/" style="font-size: 10.77px;">hexo</a> <a href="/tags/hide/" style="font-size: 10.77px;">hide</a> <a href="/tags/html5/" style="font-size: 16.92px;">html5</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/hybrid/" style="font-size: 10px;">hybrid</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/jquery/" style="font-size: 17.69px;">jquery</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/js代码片段/" style="font-size: 12.31px;">js代码片段</a> <a href="/tags/mock/" style="font-size: 10px;">mock</a> <a href="/tags/ms/" style="font-size: 10px;">ms</a> <a href="/tags/mvvm/" style="font-size: 11.54px;">mvvm</a> <a href="/tags/nginx/" style="font-size: 12.31px;">nginx</a> <a href="/tags/node/" style="font-size: 13.85px;">node</a> <a href="/tags/npm/" style="font-size: 13.08px;">npm</a> <a href="/tags/promise/" style="font-size: 10px;">promise</a> <a href="/tags/react/" style="font-size: 19.23px;">react</a> <a href="/tags/redux/" style="font-size: 13.08px;">redux</a> <a href="/tags/sublime/" style="font-size: 15.38px;">sublime</a> <a href="/tags/svn/" style="font-size: 10.77px;">svn</a> <a href="/tags/taro/" style="font-size: 10px;">taro</a> <a href="/tags/todolist/" style="font-size: 10px;">todolist</a> <a href="/tags/video/" style="font-size: 10px;">video</a> <a href="/tags/vscode/" style="font-size: 11.54px;">vscode</a> <a href="/tags/vue/" style="font-size: 18.46px;">vue</a> <a href="/tags/vuex/" style="font-size: 10.77px;">vuex</a> <a href="/tags/webpack/" style="font-size: 15.38px;">webpack</a> <a href="/tags/webstorm/" style="font-size: 10px;">webstorm</a> <a href="/tags/xhtml/" style="font-size: 10px;">xhtml</a> <a href="/tags/中间件/" style="font-size: 10px;">中间件</a> <a href="/tags/事件/" style="font-size: 10px;">事件</a> <a href="/tags/事件流/" style="font-size: 10px;">事件流</a> <a href="/tags/优质文章分享/" style="font-size: 11.54px;">优质文章分享</a> <a href="/tags/作用域/" style="font-size: 10px;">作用域</a> <a href="/tags/前端优化/" style="font-size: 10.77px;">前端优化</a> <a href="/tags/前端基础/" style="font-size: 10px;">前端基础</a> <a href="/tags/前端自动化/" style="font-size: 10px;">前端自动化</a> <a href="/tags/前端规范/" style="font-size: 14.62px;">前端规范</a> <a href="/tags/原型链/" style="font-size: 10px;">原型链</a> <a href="/tags/小程序/" style="font-size: 13.85px;">小程序</a> <a href="/tags/居中/" style="font-size: 10px;">居中</a> <a href="/tags/异步回调/" style="font-size: 10px;">异步回调</a> <a href="/tags/微信开发/" style="font-size: 11.54px;">微信开发</a> <a href="/tags/快应用/" style="font-size: 10px;">快应用</a> <a href="/tags/性能优化/" style="font-size: 10px;">性能优化</a> <a href="/tags/排序算法/" style="font-size: 10px;">排序算法</a> <a href="/tags/最佳实践/" style="font-size: 10px;">最佳实践</a> <a href="/tags/正则表达式/" style="font-size: 10.77px;">正则表达式</a> <a href="/tags/测试/" style="font-size: 10px;">测试</a> <a href="/tags/知识点/" style="font-size: 11.54px;">知识点</a> <a href="/tags/移动端/" style="font-size: 13.08px;">移动端</a> <a href="/tags/组件化/" style="font-size: 10px;">组件化</a> <a href="/tags/继承/" style="font-size: 10.77px;">继承</a> <a href="/tags/缓存/" style="font-size: 10px;">缓存</a> <a href="/tags/读书笔记/" style="font-size: 10.77px;">读书笔记</a> <a href="/tags/跨域/" style="font-size: 11.54px;">跨域</a> <a href="/tags/踩过的坑/" style="font-size: 16.92px;">踩过的坑</a> <a href="/tags/适配/" style="font-size: 10px;">适配</a> <a href="/tags/速查表/" style="font-size: 10px;">速查表</a> <a href="/tags/部署/" style="font-size: 10.77px;">部署</a> <a href="/tags/闭包/" style="font-size: 10px;">闭包</a> <a href="/tags/面向对象/" style="font-size: 10.77px;">面向对象</a> <a href="/tags/面试/" style="font-size: 12.31px;">面试</a> <a href="/tags/高阶函数/" style="font-size: 10.77px;">高阶函数</a>
        </div>
    </div>
</div>
<div class="search-wrap">
    <span class="search-close">×</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>
<script src="//cdn.ru23.com/js/search.js"></script>
<script src="//cdn.ru23.com/js/main.js"></script>









<script src="//cdn.ru23.com/js/pop-img.js"></script>
<script>
  $(".article-entry p img").popImg();
</script>

  </div>


<script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>